<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00FFFF">
    <link rel="icon" type="image/x-icon" href="images/icons/favicon.ico">
    <title>Quiz Ended</title>
    <link href="styles/style.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- YouTube IFrame Player API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="scripts/app.js" defer></script>
    <script src="scripts/musicPlayer.js" defer></script>
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div id="contentEindeQuiz">
        <h2 id="EindeQuizTitle">Quiz Ended</h2>
        <form id="username-form">
            <label for="username">Enter your username:</label>
            <input type="text" id="username" name="username" required>
            <!-- Submit button hidden, used only for form submission -->
            <button id="submit-btn" type="submit" style="display: none;"></button>
        </form>
        <div id="score-container">
            <h3 id="TotaleScore">Your total score:</h3>
            <p id="correct-counter">0</p>
        </div>
        <button id="submit-form-btn">Submit</button>
        <button id="ToggleMusicButton"><i class="fas fa-volume-mute"></i></button>
        <div id="scoreList">
            <!-- Scores will be dynamically added here -->
        </div>
    </div>
    <div id="player" style="display: none;"></div>
    <script>
        // Function to display all scores in the HTML
        function displayScoresInHTML(scores) {
            var scoreListContainer = document.getElementById('scoreList');
            scoreListContainer.innerHTML = ''; // Clear previous content

            scores.forEach(function(score) {
                var scoreElement = document.createElement('div');
                scoreElement.textContent = 'Username: ' + score.username + ', Score: ' + score.score + ', Category: ' + score.category;
                scoreListContainer.appendChild(scoreElement);
            });
        }
document.addEventListener('DOMContentLoaded', () => {
    // Ensure IndexedDB is supported
    if (!window.indexedDB) {
        console.log("IndexedDB not supported.");
    }

    // Open (or create) the database
    var request = indexedDB.open("quizDB", 1);
    var db;

    // Handle database upgrades
    request.onupgradeneeded = function(event) {
        db = event.target.result;
        // Create an object store for user scores with auto-increment key
        var scoreStore = db.createObjectStore("scores", { keyPath: "id", autoIncrement: true });
        scoreStore.createIndex("username", "username", { unique: false });
        scoreStore.createIndex("score", "score", { unique: false });
        scoreStore.createIndex("category", "category", { unique: false });
    };

    request.onsuccess = function(event) {
        db = event.target.result;
        displayAllScores(); // Call function to display all scores
    };

    request.onerror = function(event) {
        console.log("Error opening database:", event);
    };

    // Function to display all scores
    function displayAllScores() {
                var transaction = db.transaction(["scores"], "readonly");
                var scoreStore = transaction.objectStore("scores");
                var request = scoreStore.openCursor();
                var scores = [];

                request.onsuccess = function(event) {
                    var cursor = event.target.result;
                    if (cursor) {
                        scores.push(cursor.value);
                        cursor.continue();
                    } else {
                        console.log("No more entries");
                        displayScoresInHTML(scores); // Display scores in HTML
                    }
                };

                request.onerror = function(event) {
                    console.log("Error retrieving scores:", event);
                };
            }
            displayAllScores();
});

        // Ensure IndexedDB is supported
        if (!window.indexedDB) {
            console.log("IndexedDB not supported.");
        }

        // Open (or create) the database
        var request = indexedDB.open("quizDB", 1);
        var db;

        // Handle database upgrades
        request.onupgradeneeded = function(event) {
            db = event.target.result;
            // Create an object store for user scores with auto-increment key
            var scoreStore = db.createObjectStore("scores", { keyPath: "id", autoIncrement: true });
            scoreStore.createIndex("username", "username", { unique: false });
            scoreStore.createIndex("score", "score", { unique: false });
            scoreStore.createIndex("category", "category", { unique: false });
        };

        request.onsuccess = function(event) {
            db = event.target.result;
        };

        request.onerror = function(event) {
            console.log("Error opening database:", event);
        };

        // Function to store username, score, and category
        function storeUserScore(username, score, category) {
            var transaction = db.transaction(["scores"], "readwrite");
            var scoreStore = transaction.objectStore("scores");

            var userScore = {
                username: username,
                score: score,
                category: category
            };

            var request = scoreStore.add(userScore);

            request.onsuccess = function() {
                console.log("Score added:", userScore);
            };

            request.onerror = function(event) {
                console.log("Error adding score:", event);
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const totalScore = localStorage.getItem('totalScore');
            const category = localStorage.getItem('categoryName');
            document.getElementById('correct-counter').textContent = totalScore;

            document.getElementById('submit-form-btn').addEventListener('click', function(event) {
                document.getElementById('submit-btn').click();
            });

            document.getElementById('username-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const username = document.getElementById('username').value;
                const totalScore = parseInt(localStorage.getItem('totalScore'), 10) || 0;

                storeUserScore(username, totalScore, category);
                localStorage.setItem('username', username);
                window.location.href = "index.html";
            });
        });
    </script>
</body>
</html>

