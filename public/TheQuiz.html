<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00FFFF">
    <link rel="icon" type="image/x-icon" href="images/icons/favicon.ico">
    <title>Quiz</title>
    <link href="styles/style.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- YouTube IFrame Player API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="scripts/app.js" defer></script>
    <script src="scripts/musicPlayer.js" defer></script>
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div id="contentTheQuiz">
        <h2 id="category"></h2>
        <div id="question">...</div>
        <h2 id="keuzes">Choices</h2>
        <div id="choices">...</div>
        <button id="submit-answer">Submit Answer</button>
        <button id="ToggleMusicButton"><i class="fas fa-volume-mute"></i></button>
        <h2 id="overigeTijd">Time Remaining: <span id="timer">05:00</span></h2>
        <h2 id="score">SCORE: <span id="correct-counter">0</span></h2>
    </div>
    <!-- YouTube video for background music -->
    <div id="player" style="display: none;"></div>
    <script>
        let correctAnswer = "";
        let correctCounter = 0;

        document.addEventListener('DOMContentLoaded', () => {
            displayStoredData();
            startTimer(300, document.getElementById('timer'));

            document.getElementById('submit-answer').addEventListener('click', () => {
                checkAnswer(correctAnswer);
            });
        });

        function displayStoredData() {
            const category = localStorage.getItem('categoryName');
            const categoryId = localStorage.getItem('category');
            const difficulty = localStorage.getItem('difficulty');

            document.getElementById('category').innerHTML = category;

            if (categoryId && difficulty) {
                fetchNewQuestion(categoryId, difficulty);
            }
        }

        function fetchNewQuestion(categoryId, difficulty) {
            let url = `https://opentdb.com/api.php?amount=1&category=${categoryId}&difficulty=${difficulty}`;

            fetch(url)
                .then(response => response.json())
                .then(showData)
                .catch(onRejected);
        }

        function onRejected(error) {
            console.error("Error: ", error);
        }

        function showData(jsonData) {
            const question = document.getElementById("question");
            const choicesContainer = document.getElementById("choices");

            const data = jsonData.results[0];

            question.innerHTML = data.question;

            choicesContainer.innerHTML = "";

            if (data.type === "multiple") {
                const choices = [...data.incorrect_answers, data.correct_answer];
                shuffleArray(choices);

                choices.forEach(choice => {
                    const choiceElement = document.createElement("div");
                    const inputElement = document.createElement("input");
                    const labelElement = document.createElement("label");

                    inputElement.type = "radio";
                    inputElement.name = "choice";
                    inputElement.value = choice;

                    labelElement.textContent = choice;
                    labelElement.prepend(inputElement);

                    choiceElement.appendChild(labelElement);
                    choicesContainer.appendChild(choiceElement);
                });
            } else if (data.type === "boolean") {
                choicesContainer.innerHTML = `
                    <div>
                        <label><input type="radio" name="choice" value="True"> True</label>
                    </div>
                    <div>
                        <label><input type="radio" name="choice" value="False"> False</label>
                    </div>
                `;
            }

            correctAnswer = data.correct_answer;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function checkAnswer(correct) {
            const selected = document.querySelector('input[name="choice"]:checked');
            if (selected) {
                if (selected.value === correct) {
                    alert('Correct!');
                    correctCounter++;
                    document.getElementById('correct-counter').textContent = correctCounter;
                } else {
                    alert(`Not correct! The correct answer is: ${correct}`);
                }
                fetchNewQuestion(localStorage.getItem('category'), localStorage.getItem('difficulty'));
            } else {
                alert('Please select an answer.');
            }
        }

        function startTimer(duration, display) {
            let timer = duration, minutes, seconds;
            const interval = setInterval(() => {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(interval);
                    localStorage.setItem('totalScore', correctCounter);
                    localStorage.setItem('categoryName', document.getElementById('category').innerText);
                    window.location.href = "EindeQuiz.html";
                }
            }, 1000);
        }
                         // 3 min timer test doel 
         /*
        function startTimer(duration, display) {
         let timer = duration, seconds;
        const interval = setInterval(() => {
        seconds = parseInt(timer % 60, 10);
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = "00:" + seconds; // Fixed minutes to 00 since it's always 0 for 30 seconds countdown

            if (--timer < 0) {
                 clearInterval(interval);
                window.location.href = "EindeQuiz.html";  // Redirect to the Quiz Ended page
                // Store correctCounter in localStorage to be retrieved on QuizEnded.html
                localStorage.setItem('totalScore', correctCounter);
            }
         }, 1000);
    }

document.addEventListener('DOMContentLoaded', () => {
    startTimer(30, document.getElementById('timer')); // 30 seconds timer
});
*/
    </script>
</body>
</html>






